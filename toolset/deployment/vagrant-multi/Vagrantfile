# -*- mode: ruby -*-
# vi: set ft=ruby :

require_relative '../vagrant/common'
provider = get_provider
check_provider_needs(provider)

require_relative 'production-env'

Vagrant.configure("2") do |config|
  
  # Put the keys inside each box
  Dir['keys/*'].each do |fname|
    config.vm.provision :file do |file|
      file.source = fname
      file.destination = "~/.ssh/" + File.basename(fname)
    end
  end

  config.vm.define "client" do |client|
    provision_bootstrap(client, "client")
    provider_aws(client, "loadgen", "172.16.0.17")
    provider_virtualbox(client, "client", "172.16.0.17")
  end

  config.vm.define "db" do |db|
    provision_bootstrap(db, "database")
    provider_aws(db, "database", "172.16.0.18")
    provider_virtualbox(db, "database", "172.16.0.18")
  end

  # Define the app server as the primary VM
  config.vm.define "app", primary: true do |app|
    provision_bootstrap(app, "server")
    provider_aws(app, "appserver", "172.16.0.16")
    provider_virtualbox(app, "server", "172.16.0.16")
  end

end
